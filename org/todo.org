보내는분 성명

0.9 에는 주문 내역에 '보내는이' 정보가 있는 경우는 이 정보를 사용. 이 항목이 없거나 비어 있으면 업체 정보 파일의 '거래처명' 사용
1.0 에는 업체 정보 파일의 '거래처명' 사용

이렇게 변화되어 있는데, 어디도 설명이 잘 없어요..
아시겠지만 너무 변화가 많아서 따라가기가 힘이 듭니다.



- 한 메일에 주문 엑셀 파일이 여러개인 경우, 위와 같은 테이블을 엑셀 파일 갯수만큼 만들어서 구분되도록 메일 내용에 넣어 전송한다.
분명히 주문 엑셀 파일이 여러개인 경우 에러로 처리하기로 되어 있었는데요, 이게 어느순간 바뀌어 있네요.

제가 요구사항 바뀌는 것들을 가급적 처리해드리고 있으나.. 너무 많아서..
오류로 처리하겠습니다.

관련하여, 다음 테스트를 하려해도, attachment 가 2개라 테스트를 못하고 있습니다. attachment 1 인것으로 샘플 이메일 부탁드립니다.
한 주문자가 여러 row 에 주문한 예는 아래 메일을 보시면 됩니다.
  7/17 3:26 알앤쇼핑의 ‘★꿈꾸는이웃(알앤쇼핑)_[광동] 6년근 에이스홍삼스틱_발주서_20180709081954.xls’


get_logistics_info 에 email 의 id 를 전달했다가 전달받으면 좋겠습니다.
email 을 찾는데 그편이 수월할 것 같습니다.


company.xlsx 에서 자동화여부가 0 이면 email 이 있더라도 처리하지 않는건가요?
오류로 처리하면 되죠?



* TODO 메일의 상태 관리
  - [X] 처리해야 할 메일인지 ..
    - [X] 메일 제목 에 특정 단어
    - [X] 메일 주소
    - [X] 엑셀 파일 있는지
    - [X] 제목 본문에 특정 단어 포함
  - [ ] 주문 처리, 송장번호 입력, 회신 여부
    - [ ] model
    - [ ] template 에 넣자
  - [X] status 를 긁어온다
  - [X] 주문 완료 버튼
    - [X] 팝업
    - [X] 완료 처리
  - [X] manual button

* TODO reply
  - [X] save df
  - [X] call get_logistics_info
  - [ ] 받는분 from df
  - [ ] 운송장번호, 받는분 주소, 품목 get_logistics_info
  - [ ] table template
  - [ ] case 2



* TODO logistics 정리
  - [X] elligible
    - [X] 등록된 메일 주소로부터 온 메일만 주문 처리 : company.xlsx 의 '자동화 여부' 항목에 저장된 값 사용
    - [X] 메일 제목에서 처음 글자 시작이 AAA 인 메일만 주문 처리 (예: 자동-) : include-title.txt 에 저장된 값 사용
    - [X]  - 메일 제목 또는 본문에 특정 단어가 포함된 경우는 주문 처리 안 함 (예: CS, 반품) : exclude-keyword.txt 에 저장된 값 사용
  - [ ] output 폴더 위치 mpemail/output
  - [X] 여러 email 을 합쳐서 하나로 저장
  - [X] 전화번호가 숫자로 나옴
  - [X] 품목이 list 형태임..
  - [X] Not all names specified in 'columns' are found; this will raise a KeyError in the future
  - [X] 2A 요구사항 바뀐것 적용
  - [X] order 는 판매자별 품목별로 합쳐서 저장


* NEXT excel column ordering
  CLOSED: [2018-07-30 Mon 21:18]


* TODO 배송 엑셀 만들기
  - [X] 기본적인 다른 column 들 정보 채워넣기
  - [X] 한 seller 가 여러 email 을 가질 수 있다

  - [ ] 한 주문자가 여러 row 에 주문한 예는 아래 메일을 보시면 됩니다.
  7/17 3:26 알앤쇼핑의 ‘★꿈꾸는이웃(알앤쇼핑)_[광동] 6년근 에이스홍삼스틱_발주서_20180709081954.xls’
  - [X] 주문 번호 할당하기

* TODO 주문 엑셀 파일
  - [X] 품목 수량
  - [X] 다른 컬럼들


* DONE inbox 에 있는 메일 목록을 가져와서 db 에 쌓는다
  CLOSED: [2018-07-24 화 20:18]
  - [X] inbox 로 가져온 목록을 django server 에 보낸다
  - [X] django 는 mail id 로 get or create 한다
  - [X] mail 에 대해 보내야할 목록
    - [X] mail id
    - [X] title
    - [X] sender
    - [X] attachment info
    - [X] 본문 내용

* DONE attachment 를 가져와서 db 에 넣자
  CLOSED: [2018-07-24 화 23:34]

* DONE git 정리할 것
  CLOSED: [2018-07-24 화 20:18]

* DONE attachment 를 파싱하자
  CLOSED: [2018-08-10 금 13:28]
  - [X] 고객성명, 우편번호, 주소, 전화번호, 품목, 수량, 배송메시지
  - [X] keyword-title.xlsx
  - [X] 품목, 수량
    - [X] 제품 수량이 수량란에도 있고 품목란에도 있을 수 있다.
    - [X] 품목명: 황제침향단 30환 [A0003] 2개 // 황제침향단 60환 [A0004] 1개           수량 : 1           <- 수량이 3 또는 비어 있어야 함
    - [X] 제품코드와 수량 중간에 여러 형태의 문자가 들어갈 수 있습니다.
      한삼인 6년근 백세홍삼정 스틱 [A0114](2개)
      (디딤쇼핑)고이담은 흑염소진액골드 80ml x 30포 [A0129] *  2개
      (디딤)옻가네 참옻발효진액 1500ml [A0026] x 2병                <- 이 경우는 오류로 처리 (N개 형식이 아니기 때문)
      [알앤] 광동 침향보력환/옵션=2) 60환 [A0126](1개)
      [알앤] 광동 침향보력환/옵션=2) 60환 [A0126](0개)             <- 이 경우는 오류로 처리 (수량이 1개 이상이어야 하기 때문)
      한삼인 황제침향단 (선택:선택2) 한삼인 황제침향단 60환  )[A0100] 5개
      [광동] 6년근 에이스홍삼스틱 [A0197] →2개
      6년근 고려홍삼정365(240g*4병세트)[A0092][2개]
      [테크] 고이담은즙 4종 (도라지배즙,양파즙,칡즙,홍삼)/옵션=1) 칡즙[A0085] (2개)//[테크] 고이담은즙 4종 (도라지배즙,양파즙,칡즙,홍삼)/옵션=2) 양파즙[A0087] (2개)

    - [X] keyword-title excel 읽자
    - [X] 품목 동의어를 얻는다
    - [X] 품목 동의어들로 품목 column 을 찾는다
    - [X] 코드 명과 수량을 가져온다
    - [X] output df 에 넣는다


* TODO 송장 번호 받기
  - [ ] excel 을 올리기
  - [ ] api 호출하기
  - [ ] 메일 쓰기



* TODO

  다음과 같은 요구사항을 봤었는데, 어디에 있었는지 찾을 수가 없네요..
  현재 요구사항 문서에는 없어 보이는데요
  이메일로 전달해주신 내용이라도 요구사항 문서에 없으면 요구사항 문서에 넣어주시면 좋겠습니다.
  그리고 아래 경우 오류로 처리하는 경우, 한 행에 대해서 오류가 되는 건가요? 전체 메일이 비규격 처리가 되는건가요?
  한행에 대한 오류만 있더라도 전체를 비규격 처리하는 거였죠?
      한삼인 6년근 백세홍삼정 스틱 [A0114](2개)
       (디딤쇼핑)고이담은 흑염소진액골드 80ml x 30포 [A0129] *  2개
       (디딤)옻가네 참옻발효진액 1500ml [A0026] x 2병                <- 이 경우는 오류로 처리 (N개 형식이 아니기 때문)
       [알앤] 광동 침향보력환/옵션=2) 60환 [A0126](1개)
       [알앤] 광동 침향보력환/옵션=2) 60환 [A0126](0개)             <- 이 경우는 오류로 처리 (수량이 1개 이상이어야 하기 때문)
       한삼인 황제침향단 (선택:선택2) 한삼인 황제침향단 60환  )[A0100] 5개
       [광동] 6년근 에이스홍삼스틱 [A0197] →2개
       6년근 고려홍삼정365(240g*4병세트)[A0092][2개]
       [테크] 고이담은즙 4종 (도라지배즙,양파즙,칡즙,홍삼)/옵션=1) 칡즙[A0085] (2개)//[테크] 고이담은즙 4종 (도라지배즙,양파즙,칡즙,홍삼)/옵션=2) 양파즙[A0087] (2개)

   keyword-title 에서 '우편번호' 컬럼에는 '우편번호' 도 있으면 좋겠습니다. (다른 컬럼들도 마찬가지구요)

   택배파일에서 핸드폰번호' 를 어떤 값으로 입력하는지요

   - Case 2-A) 주문 엑셀 파일의 행들 가운데 주소 값이 같은 행이 있는 경우
     이 경우 품목 외의 컬럼들은 아무 행의 값을 사용해도 되나요? 주소 말고 다른 값들이 다른 경우 어떻게 처리하나요?


* TODO
  주문 파일에 단가를 가져올 방법을 모르겠네요
